default_devtarget: dev-local

global:
  DEFAULT_CMD_EXEC: make -f $(DEVIND_MAKEFILE_ENTRY) $(GOAL)
  CMD_PREFIX:
  CMD_SUFFIX:

profiles:
  docker:
    DOCKER_CMD: docker run
  docker-interactive:
    DOCKER_OPT+: -it
  docker-remove:
    DOCKER_OPT+: --rm
  docker-bind-workspace:
    DOCKER_OPT+: -v .:/work
    DOCKER_OPT+: -w /work
  dummy:
    DUMMY_VAR: dummy
  remote-1:
    SSH_USER: user1
    SSH_HOST: host1
  ssh-root:
    SSH_USER: root
  ssh-host:
    SSH_HOST: host
  ssh-user2:
    SSH_USER: user2
  ssh-host2:
    SSH_HOST: host2

devtargets:
  local:
    var:
      CMD_EXEC: $(DEFAULT_CMD_EXEC)

  ssh:
    var:
      CMD_PREFIX: @echo "remote ssh command: ssh $(SSH_USER)@$(SSH_HOST)
      CMD_EXEC: $(DEFAULT_CMD_EXEC)
      CMD_SUFFIX: "

  docker:
    profiles:
      - docker
      - docker-remove
      - docker-interactive
      - docker-bind-workspace
    var:
      DOCKER_IMAGE: hello-devind:latest
      CMD_PREFIX: $(DOCKER_CMD) $(DOCKER_OPT) $(DOCKER_IMAGE)
      CMD_EXEC: $(DEFAULT_CMD_EXEC)
      
  dummy:
    var:
      CMD_PREFIX: [DUMMY_PREFIX]
      CMD_EXEC: echo "dummy command"
      CMD_SUFFIX: [DUMMY_SUFFIX]

goals:
  hello: dev-docker
  clean: dev-local
  build: dev-docker
  dummy: dev-dummy
  remote-1-push: dev-ssh remote-1
  remote-2-push: dev-ssh ssh-host ssh-root
  remote-3-push: dev-ssh remote-1 ssh-root
